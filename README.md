##### 目錄

- [前言]（#0）
- [發明展縣賽初賽作品說明書](#1)
	- [壹、前言](#1.1)
	- [貳、研發動機](#1.2)
	- [參、採訪彙整](#1.3)
	- [肆、製作過程](#1.4)
	- [伍、未來展望](#1.5)
- [7697模組](#2)
	- [程式邏輯](#2.1)
	- [電路](#2.2)
- [資料庫](#3)
- [資料庫端](#4)
	- [程式說明](#4.1)
- [查詢端](#5)
	- [程式說明](#5.1)

---

<h5 id="0">前言</h5>

此程式為「病人在這裡！」系統的概念，目的是在醫院中幫助醫護人員尋找病人所在區域。查詢端的程式我已經轉成應用程式了，若你的電腦是Windows系統，可下載並執行檔名為`searchAndShowResultForWindows.exe`的檔案；若你的電腦是MacOS系統，可下載並執行檔名為`searchAndShowResultForMacOS.app`的檔案。

---

<h5 id="1">發明展縣賽初賽作品說明書</h5>

<h4 id="1.1">壹、前言</h4>

> 「病人在這裡！」是一套在醫院裡幫助醫護人員尋找病人所在區域的系統，只需在要道安裝RFID感應器，並在身分識別手環上加貼電子標籤，就能藉此知道病人所在區域。因此尋找病人時可以縮小搜索範圍；也可透過警報提醒病人離開禁區（如護理站等）；在廁所、逃生梯等人流較少的區域發生意外，不易被人察覺，若待在廁所等區域的時間過久，很有可能就是發生意外的警訊，因此當「病人在這裡！」系統發現病人待在廁所等區域時間過久時，就會自動發送通知給醫護人員，只要提早發現，就有更多的機會挽回生命、減少傷害；「病人在這裡！」系統甚至還可以在病人進行檢查、手術前多做一次身分核對。我們也透過採訪護理師發現醫護人員對於「病人在這裡！」的構想表示肯定。

<h4 id="1.2">貳、研發動機</h4>

> 偶然機會發現醫護人員常常在問：「ΟΟ病人在哪裡？」，因此我們透過採訪護理師，了解醫護人員的工作困境，並深入討論各種可能的解決方案。討論期間，也發現護理師非常期待「病人在這裡！」的構想能夠實現成真。這一切都成為我們持續創作、永不放棄的動力。

<h4 id="1.3">參、採訪彙整</h4>

> 我們透過採訪護理師並討論，將醫護人員的工作困境及我們想到的解決方案整理成下表。

<h4 id="1.4">肆、製作過程</h4>

> RFID感測模組製作：
> 利用7697開發板及MFRC522 RFID感測器取得病人手環上的電子標籤唯一碼。

> 寫入病人出入資訊到資料庫中： 將RFID感測模組取得的電子標籤唯一碼、時間及門扇位置寫入資料庫。

> 醫院模型製作： 利用木板製作醫院的模型，以利實驗。

> 利用程式判斷病人位置： 利用病人上次的位置及穿過的門，判斷病人所在位置。

> 監控病人的位置資訊： 利用Python的Tkinter模組製作行動護理站上的圖形化監控系統，將病人所在位置的資訊顯示給醫護人員。

> 病人進入護理站或頂樓發出警報： 若病人進入護理站或頂樓，就會發出警報提醒病人及護理師。

> 在廁所或逃生梯的時間過長： 透過資料庫中最後一筆資料，得知病人是否在廁所或逃生梯的時間超過1個小時，若在廁所或逃生梯的時間超過1個小時，就傳送通知給護理師。

> 感應式健保卡： 將電子標籤唯一碼連接健保系統，以利身分核對。

<h4 id="1.5">伍、未來展望</h4>

> 一、「行動護理站」已普及各大醫院，「行動護理站」就是在「行動護理工作車」上安裝移動系統，成為移動式的護理站，可減少護理師回到護理站的次數。因此我們希望將「病人在這裡！」系統的資料庫連接到「行動護理站」上，並利用圖形化介面顯示病人的所在區域及停留時間，以方便醫護人員隨時尋找病人。

> 二、讓病人或家屬簽署「病人在這裡！」系統的使用同意書，並將「病人在這裡！」系統的檢視權限分類，醫護人員看到的內容會隨著工作層級而有所差異，保護病人的個資安全。

> 三、將作品封裝美化，並安裝到醫院進行測試，進而了解醫護人員、病人及家屬對於「病人在這裡！」系統的接受度、以及「病人在這裡！」系統的實際便利性。

> 四、進行各種「病人在這裡！」系統對人體影響的實驗，以及通過各種國家級檢驗，避免「病人在這裡！」系統在實際使用時，造成病人的健康問題。

---

<h5 id="2">7697模組</h5>

<h4 id="2.1">程式邏輯</h4>

> 利用MQTT發送訊息至預先架設好的MQTT伺服器，主題設為`/IEYI/hrjh/7697/publish`。訊息內容包含病人手環上電子標籤的唯一碼（UID）、時間，以及門的代碼。

<h4 id="2.2">電路</h4>

> 將RC522 RFID感測模組連接7697即可。

---

<h5 id="3">資料庫</h5>

>資料庫檔名為`TEST.db`，包含10個欄位
>>一、編號：此編號無意，僅為了程式尋找資料用，在資料庫中的名稱為`NO`。

>>二、姓名：病人的姓名，在資料庫中的名稱為`NAME`。

>>三、身分證字號：病人的身分證字號，在資料庫中的名稱為`ID`。

>>四、電子標籤唯一碼：病人手環上電子標籤的唯一碼，在資料庫中的名稱為`UID`。

>>五、床號：病人病床的編號，在資料庫中的名稱為`BEDNO`。

>>六、倒數第二個通過的門：病人倒數第二個通過的門，在資料庫中的名稱為`SECONDLAST`。

>>七、倒數第二個通過門的時間：病人倒數第二個通過門的時間，在資料庫中的名稱為`SECONDLASTTIME`。

>>八、最後一次通過的門：病人最後一次通過的門，在資料庫中的名稱為`LAST`。

>>九、最後一次通過門的時間：病人最後一次通過門的時間，在資料庫中的名稱為`LASTTIME`。

>>十、猜測的所在位置：電腦猜測病人的所在位置，在資料庫中的名稱為`LOCATION`。

---

<h5 id="4">資料庫端</h5>

<h4 id="4.1">程式說明</h4>

程式檔名為`insertLibAndReturnSearchResult.py`，包含兩個部分，兩個部分皆在`on_message`函式中：

>一、將7697回傳回來的病人出入資訊加入資料庫
>>在`on_message`函式中，以一個`if elif`條件式為主要程式，當接收到MQTT訊息的topic為7697傳送的`/IEYI/hrjh/7697/publish`時，將資料加入資料庫中。

>二、回傳查詢端請求的資料
>>在`on_message`函式中，以一個`if elif`條件式為主要程式，當接收到MQTT訊息的topic為查詢端傳送的`/IEYI/hrjh/search/send`時，利用查詢端提供的床號，提取資料庫中的資料，並利用MQTT回傳給查詢端（topic為`/IEYI/hrjh/search/return`）。

---

<h5 id="5">查詢端</h5>

<h4 id="5.1">程式說明</h4>

程式檔名為`searchAndShowResult.py`，有兩個主函式，分別執行下列兩個任務：
>一、顯示圖形化視窗
>>函式名稱為`setObject`，負責配置視窗的內容及顯示，第一列包含一個輸入方塊以及一個按鈕；第二列有一個顯示方塊。使用者僅需在第一列的輸入方塊輸入病人的床號，並按下第一列的查詢方塊後，即會在第二列的顯示方塊顯示病人的所在區域及相關資訊。

>二、病人資料顯示
>>函式名稱為`on_message`，透過MQTT接收topic為`/IEYI/hrjh/search/return`的訊息，並將病人的所在區域及相關資訊顯示在圖形化視窗第二列的顯示方塊中。

---

<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/4b/CC_BY-NC-SA.svg/2880px-CC_BY-NC-SA.svg.png"></img>
